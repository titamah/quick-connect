import React, { useRef, useEffect, useState } from "react";
import { Stage, Layer, Rect, Group, Text } from "react-konva";
import { useDevice } from "../../contexts/DeviceContext";
import { useImageLoader } from "../../hooks/useImageLoader";
import { useImageCache } from "../../hooks/useImageCache";

const ThumbnailDiv = ({ activeState }) => {
  const { deviceInfo, background } = useDevice();
  const { patternImage, imageSize } = useImageLoader(background, deviceInfo.size);
  const { loadImage } = useImageCache();
  
  const [grainImage, setGrainImage] = useState(null);
  const [transparentImage, setTransparentImage] = useState(null);
  const grainLoadedRef = useRef(false);
  const transparentLoadedRef = useRef(false);

  // Thumbnail dimensions
  const THUMBNAIL_HEIGHT = 160;
  const THUMBNAIL_WIDTH = 320;
  const THUMBNAIL_PADDING = THUMBNAIL_WIDTH / 10;
  const PHONE_WIDTH = THUMBNAIL_WIDTH * 0.35;
  const PHONE_HEIGHT = THUMBNAIL_WIDTH * 0.8;
  const QR_SIZE = PHONE_WIDTH / 2;
  const QR_GROUP_SIZE = QR_SIZE + QR_SIZE * (activeState?.qr.borderWidth / 100);

  // Base positions
  const baseX = PHONE_WIDTH / 4;
  const baseY = THUMBNAIL_PADDING;

  // Offset calculations
  const xOffset = (0.5 - activeState?.qr.pos.x) * PHONE_WIDTH;
  const yOffset = (0.5 - activeState?.qr.pos.y) * PHONE_HEIGHT;

  // Final positions
  const QRXpos = baseX + xOffset;
  const PhoneYpos = baseY + yOffset;

  // Background props (same logic as Wallpaper component)
  const backgroundProps = {
    width: background.style === "image" && background.bg && patternImage ? imageSize.scaledWidth : deviceInfo.size.x,
    height: background.style === "image" && background.bg && patternImage ? imageSize.scaledHeight : deviceInfo.size.y,
    x: background.style === "image" && background.bg && patternImage ? imageSize.offsetX : 0,
    y: background.style === "image" && background.bg && patternImage ? imageSize.offsetY : 0,
  };

  // Load grain and transparent images
  useEffect(() => {
    if (!grainLoadedRef.current) {
      grainLoadedRef.current = true;
      const controller = new AbortController();
      
      loadImage("/grain.jpeg", { 
        crossOrigin: "anonymous",
        signal: controller.signal 
      })
        .then((img) => {
          setGrainImage(img);
        })
        .catch((error) => {
          if (error.name !== 'AbortError') {
            console.error("Failed to load grain texture", error);
          }
          setGrainImage(null);
        });
    }
  }, [loadImage]);

  useEffect(() => {
    if (!transparentLoadedRef.current) {
      transparentLoadedRef.current = true;
      const controller = new AbortController();
      
      loadImage("/transparent.png", { 
        crossOrigin: "anonymous",
        signal: controller.signal 
      })
        .then((img) => {
          setTransparentImage(img);
        })
        .catch((error) => {
          if (error.name !== 'AbortError') {
            console.error("Failed to load transparent texture", error);
          }
          setTransparentImage(null);
        });
    }
  }, [loadImage]);

  return (
    <div
            id="Thumbnail"
            className=" relative border border-[var(--border-color)] mx-3.5 mb-3.5 rounded-md overflow-hidden flex items-center justify-center"
            style={{
              height: `${THUMBNAIL_HEIGHT}px`,
              width: `${THUMBNAIL_WIDTH}px`,
              padding: `${THUMBNAIL_PADDING}px`,
            //   border:"BLUE",
            //   borderWidth: `${THUMBNAIL_PADDING}px`
            }}
          >
            <span
              className="absolute w-fit h-fit text-center justify-center items-center flex flex-col rubik font-extrabold leading-none"
              style={{
                fontSize: `${THUMBNAIL_HEIGHT * 0.1}px`,
                color: `${activeState?.qr.borderColor}`,
                top: `${THUMBNAIL_WIDTH / 12.5}px`,
                left: `${THUMBNAIL_PADDING}px`,
                gap: `${THUMBNAIL_HEIGHT / 20}px`,
              }}
            >
              MADE WITH
              <svg
                width={`${THUMBNAIL_HEIGHT / 2}px`}
                height={`${THUMBNAIL_HEIGHT / 2}px`}
                viewBox="0 0 599 592"
                fill={activeState?.qr.primaryColor}
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_651_1629)">
                  <path d="M579 452C585.6 452 592.2 452 599 452C599.069 468.325 599.123 484.649 599.155 500.974C599.171 508.554 599.192 516.134 599.226 523.714C599.256 530.322 599.276 536.93 599.282 543.537C599.286 547.035 599.295 550.533 599.317 554.031C599.341 557.938 599.342 561.845 599.341 565.752C599.351 566.909 599.362 568.066 599.373 569.257C599.345 576.532 598.554 581.032 593.688 586.688C587.001 592.441 581.229 592.42 572.752 592.341C571.523 592.341 570.293 592.341 569.026 592.342C565.666 592.34 562.308 592.325 558.949 592.304C555.433 592.285 551.918 592.284 548.402 592.28C541.751 592.271 535.101 592.246 528.45 592.216C520.875 592.182 513.301 592.166 505.727 592.151C490.151 592.12 474.576 592.066 459 592C459 585.4 459 578.8 459 572C498.6 572 538.2 572 579 572C579 532.4 579 492.8 579 452Z" />
                  <path d="M3.97265e-05 452C6.60004 452 13.2 452 20 452C20 491.6 20 531.2 20 572C59.6 572 99.2 572 140 572C140 578.6 140 585.2 140 592C123.675 592.069 107.351 592.123 91.0258 592.155C83.4457 592.171 75.8657 592.192 68.2857 592.226C61.678 592.256 55.0704 592.276 48.4627 592.282C44.9648 592.286 41.467 592.295 37.9691 592.317C34.0619 592.341 30.1549 592.342 26.2476 592.341C25.091 592.351 23.9344 592.362 22.7427 592.373C15.4681 592.345 10.9678 591.554 5.31254 586.688C-0.441146 580.001 -0.419584 574.229 -0.340536 565.752C-0.340975 564.523 -0.341413 563.293 -0.341864 562.026C-0.340136 558.666 -0.325127 555.308 -0.304142 551.949C-0.285345 548.433 -0.283622 544.918 -0.280066 541.402C-0.270754 534.751 -0.246153 528.101 -0.216017 521.45C-0.182446 513.875 -0.16598 506.301 -0.150931 498.727C-0.119602 483.151 -0.0662525 467.576 3.97265e-05 452Z" />
                  <path d="M335.191 321.612C336.012 321.607 336.833 321.602 337.679 321.596C340.427 321.582 343.175 321.589 345.923 321.596C347.895 321.59 349.866 321.583 351.837 321.575C357.191 321.557 362.544 321.558 367.897 321.564C372.365 321.567 376.834 321.561 381.302 321.555C391.843 321.541 402.383 321.543 412.924 321.554C423.8 321.565 434.676 321.551 445.553 321.525C454.889 321.502 464.226 321.496 473.563 321.502C479.14 321.505 484.717 321.503 490.294 321.485C495.538 321.47 500.782 321.474 506.026 321.493C507.95 321.496 509.875 321.493 511.799 321.483C514.427 321.47 517.054 321.481 519.681 321.499C520.442 321.489 521.204 321.48 521.988 321.47C527.128 321.541 530.04 322.76 534 326C538.054 331.459 537.45 337.672 537.433 344.188C537.439 345.363 537.444 346.539 537.449 347.751C537.456 350.232 537.454 352.713 537.446 355.194C537.437 358.987 537.466 362.778 537.498 366.57C537.5 368.984 537.499 371.398 537.496 373.813C537.507 374.944 537.518 376.075 537.53 377.241C537.475 383.469 537.21 387.281 533 392C529.171 395.365 526 396.126 520.978 396.114C519.943 396.113 518.907 396.113 517.841 396.113C516.755 396.108 515.669 396.103 514.551 396.098C513.051 396.096 513.051 396.096 511.522 396.095C507.785 396.089 504.049 396.075 500.312 396.063C491.959 396.042 483.606 396.021 475 396C475 420.42 475 444.84 475 470C491.514 469.881 491.514 469.881 508.028 469.73C510.104 469.721 512.181 469.713 514.258 469.707C515.863 469.684 515.863 469.684 517.502 469.661C523.077 469.659 527.233 469.753 532 473C535.743 477.148 537.119 479.549 537.177 485.073C537.196 486.661 537.196 486.661 537.216 488.28C537.223 489.429 537.231 490.578 537.238 491.762C537.246 492.941 537.254 494.12 537.263 495.335C537.276 497.836 537.287 500.337 537.295 502.838C537.312 506.655 537.356 510.471 537.4 514.287C537.41 516.716 537.419 519.145 537.426 521.574C537.443 522.713 537.461 523.852 537.479 525.025C537.461 531.56 537.093 535.788 533 541C528.79 544.275 524.953 544.428 519.808 544.388C518.987 544.393 518.167 544.398 517.321 544.404C514.573 544.418 511.825 544.411 509.076 544.404C507.105 544.41 505.134 544.417 503.162 544.425C497.809 544.443 492.456 544.442 487.103 544.436C482.634 544.433 478.166 544.439 473.698 544.445C463.157 544.459 452.616 544.457 442.076 544.446C431.2 544.435 420.323 544.449 409.447 544.475C400.11 544.498 390.774 544.504 381.437 544.498C375.86 544.495 370.283 544.497 364.706 544.515C359.462 544.53 354.218 544.526 348.974 544.507C347.049 544.504 345.125 544.507 343.2 544.517C340.573 544.53 337.946 544.519 335.318 544.501C334.557 544.511 333.796 544.52 333.012 544.53C327.872 544.459 324.959 543.24 321 540C316.946 534.541 317.549 528.329 317.566 521.813C317.561 520.637 317.556 519.461 317.55 518.249C317.544 515.768 317.545 513.287 317.554 510.806C317.562 507.013 317.534 503.222 317.502 499.43C317.5 497.016 317.501 494.602 317.504 492.188C317.493 491.056 317.481 489.925 317.47 488.759C317.525 482.531 317.79 478.719 322 474C325.861 470.607 329.052 469.874 334.114 469.887C335.697 469.887 335.697 469.887 337.312 469.887C338.419 469.892 339.527 469.897 340.668 469.902C341.687 469.903 342.706 469.904 343.756 469.905C347.567 469.911 351.377 469.925 355.187 469.938C363.705 469.958 372.224 469.979 381 470C381 445.58 381 421.16 381 396C364.157 396.119 364.157 396.119 347.314 396.27C345.196 396.279 343.078 396.287 340.961 396.293C339.869 396.308 338.777 396.324 337.651 396.34C332.032 396.341 327.798 396.287 323 393C319.257 388.852 317.881 386.451 317.823 380.927C317.81 379.869 317.797 378.81 317.784 377.72C317.777 376.571 317.769 375.422 317.762 374.238C317.754 373.059 317.745 371.88 317.737 370.665C317.723 368.164 317.713 365.663 317.705 363.162C317.688 359.346 317.644 355.53 317.599 351.713C317.589 349.284 317.581 346.855 317.574 344.426C317.557 343.287 317.539 342.148 317.521 340.975C317.539 334.44 317.907 330.212 322 325C326.209 321.725 330.047 321.572 335.191 321.612Z" />
                  <path d="M82.2874 321.369C83.3423 321.358 83.3423 321.358 84.4185 321.347C86.7277 321.33 89.0349 321.35 91.3441 321.371C92.9578 321.37 94.5715 321.368 96.1852 321.364C99.5612 321.361 102.936 321.376 106.312 321.403C110.63 321.437 114.947 321.431 119.264 321.412C122.595 321.402 125.925 321.411 129.255 321.426C130.847 321.431 132.438 321.431 134.03 321.424C136.258 321.419 138.485 321.439 140.713 321.467C141.979 321.473 143.244 321.479 144.548 321.485C148.637 322.095 150.797 323.43 154 326C157.414 330.939 157.468 335.54 157.512 341.336C157.53 342.215 157.548 343.095 157.566 344.001C157.62 346.792 157.654 349.583 157.688 352.375C157.721 354.275 157.755 356.175 157.791 358.074C157.876 362.716 157.943 367.358 158 372C159.734 369.966 161.465 367.931 163.196 365.895C163.679 365.327 164.163 364.76 164.662 364.176C167.846 360.425 170.895 356.602 173.875 352.688C174.323 352.1 174.771 351.512 175.233 350.907C175.591 350.436 175.948 349.965 176.317 349.48C179.417 345.434 182.607 341.463 185.813 337.5C186.352 336.829 186.891 336.159 187.447 335.468C192.044 329.808 196.103 324.849 203 322C205.812 321.716 208.398 321.579 211.205 321.596C212.407 321.586 212.407 321.586 213.632 321.575C216.265 321.557 218.898 321.561 221.532 321.566C223.369 321.562 225.207 321.557 227.045 321.551C230.892 321.542 234.738 321.544 238.585 321.554C243.508 321.565 248.43 321.545 253.353 321.516C257.146 321.498 260.94 321.498 264.734 321.504C266.548 321.504 268.363 321.498 270.178 321.485C272.718 321.47 275.256 321.481 277.795 321.498C278.913 321.484 278.913 321.484 280.053 321.469C285.165 321.541 288.083 322.749 292 326C294.339 329.727 295.37 332.772 294.875 337.125C293.078 343.642 287.926 348.362 283.516 353.268C281.073 356.06 278.824 358.997 276.563 361.938C272.362 367.355 267.975 372.574 263.481 377.75C260.031 381.743 256.732 385.828 253.5 390C249.731 394.866 245.84 399.595 241.813 404.25C232.709 414.609 232.709 414.609 225 426C231.131 433.832 237.295 441.635 243.519 449.393C246.853 453.553 250.154 457.737 253.438 461.938C257.42 467.029 261.474 472.057 265.563 477.062C270.286 482.846 274.874 488.708 279.399 494.648C282.392 498.541 285.512 502.328 288.625 506.125C304.379 525.369 304.379 525.369 304.285 533.676C303.847 537.251 302.342 539.333 300 542C296.209 544.691 291.948 544.296 287.487 544.291C286.63 544.297 285.773 544.304 284.889 544.311C282.055 544.33 279.221 544.334 276.387 544.336C274.414 544.342 272.441 544.349 270.468 544.356C266.332 544.368 262.195 544.372 258.058 544.371C252.765 544.37 247.473 544.398 242.18 544.432C238.105 544.454 234.029 544.458 229.953 544.457C228.002 544.46 226.051 544.469 224.101 544.484C221.367 544.504 218.635 544.498 215.901 544.486C215.101 544.497 214.3 544.508 213.475 544.52C206.995 544.448 202.812 542.564 197.953 538.133C197.391 537.47 196.829 536.808 196.25 536.125C195.581 535.339 194.912 534.552 194.223 533.742C191.196 530.008 188.227 526.232 185.279 522.436C182.113 518.372 178.852 514.411 175.5 510.5C170.531 504.701 165.804 498.732 161.117 492.703C159.632 490.787 159.632 490.787 158 489C157.997 489.548 157.993 490.096 157.989 490.661C157.947 496.388 157.878 502.115 157.793 507.842C157.765 509.976 157.743 512.111 157.729 514.246C157.708 517.322 157.661 520.397 157.61 523.473C157.608 524.421 157.607 525.369 157.606 526.346C157.474 532.393 156.666 536.117 153 541C148.957 544.062 145.916 544.379 140.903 544.388C139.86 544.396 139.86 544.396 138.797 544.404C136.51 544.417 134.224 544.409 131.938 544.398C130.343 544.4 128.748 544.403 127.152 544.407C123.814 544.412 120.475 544.405 117.136 544.391C112.862 544.374 108.589 544.384 104.315 544.402C101.022 544.413 97.7297 544.409 94.4371 544.401C92.8615 544.399 91.2858 544.402 89.7102 544.409C87.5058 544.417 85.3023 544.405 83.098 544.388C81.8451 544.386 80.5922 544.383 79.3013 544.381C74.4609 543.822 71.9648 542.072 68.7503 538.5C65.6986 534.14 65.8541 530.208 65.8599 525.087C65.8569 524.272 65.8539 523.457 65.8509 522.617C65.8422 519.876 65.8407 517.136 65.8392 514.395C65.8345 512.434 65.8295 510.473 65.8241 508.512C65.811 503.177 65.8046 497.842 65.8001 492.508C65.7972 489.176 65.7931 485.844 65.7886 482.513C65.7749 472.092 65.7653 461.672 65.7614 451.252C65.7569 439.216 65.7394 427.181 65.7104 415.145C65.6888 405.846 65.6787 396.548 65.6774 387.249C65.6763 381.693 65.6704 376.138 65.6525 370.582C65.6361 365.356 65.6339 360.13 65.6427 354.904C65.6435 352.986 65.6391 351.068 65.6292 349.15C65.6165 346.531 65.6224 343.913 65.6328 341.294C65.6248 340.535 65.6167 339.777 65.6084 338.995C65.668 332.607 67.3297 328.734 71.7324 324.164C75.6013 321.602 77.6818 321.372 82.2874 321.369Z" />
                  <path d="M335.782 46.6122C336.938 46.6023 338.094 46.5924 339.285 46.5822C341.174 46.589 341.174 46.589 343.102 46.5959C344.449 46.5902 345.797 46.5832 347.145 46.5751C350.803 46.5571 354.46 46.5583 358.118 46.564C361.186 46.5671 364.254 46.561 367.322 46.555C374.579 46.5409 381.836 46.5425 389.093 46.5539C396.531 46.5653 403.969 46.5514 411.408 46.5245C417.824 46.5021 424.24 46.4957 430.657 46.5016C434.475 46.5049 438.293 46.5027 442.111 46.4853C474.213 46.3529 504.439 49.752 528.418 73.3827C542.515 88.4483 548.696 107.536 548.184 128.105C546.711 151.319 539.323 169.517 522 185C521.34 185.33 520.68 185.66 520 186C520.607 190.491 522.413 194.079 524.543 198.012C524.904 198.689 525.264 199.367 525.636 200.065C526.411 201.52 527.19 202.973 527.971 204.425C529.197 206.704 530.414 208.988 531.629 211.273C535.457 218.46 539.329 225.621 543.273 232.746C543.923 233.927 544.573 235.107 545.222 236.288C546.418 238.457 547.626 240.62 548.846 242.776C551.894 248.306 553.893 252.638 554 259C552.357 263.747 550.191 266.286 546 269C543.257 269.382 540.92 269.538 538.184 269.502C537.412 269.507 536.641 269.512 535.846 269.518C533.305 269.53 530.764 269.514 528.223 269.496C526.451 269.496 524.679 269.498 522.906 269.5C519.195 269.502 515.484 269.489 511.773 269.466C507.024 269.438 502.275 269.441 497.526 269.454C493.867 269.461 490.208 269.453 486.549 269.44C484.799 269.436 483.048 269.435 481.297 269.439C478.846 269.442 476.396 269.426 473.946 269.404C472.868 269.411 472.868 269.411 471.768 269.418C465.889 269.331 462.051 267.598 457.469 264.027C453.872 259.617 451.798 254.743 449.5 249.562C448.739 247.878 448.739 247.878 447.962 246.16C446.292 242.447 444.643 238.725 443 235C442.702 234.326 442.404 233.653 442.097 232.959C439.969 228.144 437.855 223.324 435.75 218.5C435.46 217.837 435.17 217.173 434.871 216.49C434.05 214.609 433.235 212.727 432.422 210.844C431.954 209.763 431.485 208.682 431.003 207.568C430 205 430 205 430 203C425.05 203 420.1 203 415 203C415.016 204.635 415.031 206.269 415.048 207.954C415.102 214.025 415.136 220.097 415.165 226.169C415.18 228.796 415.2 231.422 415.226 234.049C415.263 237.827 415.28 241.605 415.293 245.383C415.308 246.555 415.324 247.727 415.34 248.935C415.342 259.457 415.342 259.457 412 264C407.468 268.489 405.012 269.626 398.438 269.631C397.705 269.638 396.973 269.645 396.218 269.653C393.811 269.67 391.407 269.65 389 269.629C387.319 269.63 385.638 269.632 383.957 269.636C380.44 269.639 376.923 269.624 373.406 269.597C368.907 269.563 364.409 269.569 359.909 269.588C356.44 269.598 352.971 269.589 349.502 269.574C347.843 269.569 346.184 269.569 344.526 269.576C342.204 269.581 339.884 269.561 337.563 269.533C336.244 269.527 334.925 269.521 333.566 269.515C329.316 268.901 327.243 267.797 324 265C321.022 260.249 320.569 256.133 320.612 250.657C320.607 249.832 320.602 249.007 320.596 248.157C320.582 245.4 320.589 242.644 320.596 239.887C320.59 237.907 320.583 235.928 320.575 233.948C320.557 228.576 320.558 223.204 320.564 217.832C320.567 213.347 320.561 208.861 320.555 204.375C320.541 193.793 320.543 183.211 320.554 172.628C320.565 161.713 320.551 150.797 320.525 139.882C320.502 130.508 320.496 121.133 320.502 111.759C320.505 106.161 320.503 100.564 320.485 94.9662C320.47 89.7024 320.474 84.4389 320.493 79.175C320.496 77.2445 320.493 75.3139 320.483 73.3834C320.47 70.7452 320.481 68.1082 320.499 65.47C320.489 64.7085 320.48 63.9471 320.47 63.1625C320.545 57.6966 321.78 54.4576 325 49.9999C328.575 47.1365 331.259 46.6232 335.782 46.6122ZM415 115C415 121.27 415 127.54 415 134C419.77 134.092 424.537 134.171 429.307 134.22C430.929 134.24 432.55 134.267 434.172 134.302C436.505 134.35 438.838 134.373 441.172 134.391C441.895 134.411 442.618 134.432 443.363 134.453C446.842 134.455 448.661 134.26 451.458 132.112C454.039 128.577 453.636 125.196 453 121C451.288 117.236 451.288 117.236 448 115C445.519 114.913 443.067 114.884 440.586 114.902C439.492 114.904 439.492 114.904 438.375 114.907C436.042 114.912 433.708 114.925 431.375 114.937C429.794 114.942 428.214 114.947 426.633 114.951C422.755 114.961 418.878 114.981 415 115Z" />
                  <path d="M171.937 43.6249C173.358 43.6253 173.358 43.6253 174.808 43.6256C189.546 43.6584 203.645 44.3701 218 47.9999C218.746 48.1819 219.492 48.3638 220.26 48.5512C244.138 54.5758 265.226 68.2829 278.031 89.5585C285.44 102.509 290.069 116.584 290.161 131.599C290.171 132.869 290.18 134.138 290.19 135.445C290.195 136.816 290.199 138.187 290.203 139.559C290.207 140.611 290.207 140.611 290.212 141.685C290.227 145.406 290.236 149.127 290.24 152.847C290.246 156.643 290.27 160.437 290.298 164.233C290.317 167.192 290.322 170.151 290.323 173.11C290.326 174.507 290.334 175.903 290.348 177.299C290.568 202.11 283.34 224.759 266 243C265.34 243 264.68 243 264 243C268.109 249.269 272.392 255.384 276.812 261.437C277.966 263.018 279.118 264.6 280.269 266.184C280.771 266.87 281.272 267.556 281.788 268.263C284.605 272.3 284.846 276.198 284 281C281.706 284.928 279.34 287.553 275 289C272.916 289.109 270.83 289.159 268.744 289.177C266.805 289.196 266.805 289.196 264.828 289.216C263.414 289.224 262 289.231 260.586 289.238C259.872 289.242 259.157 289.246 258.422 289.251C254.638 289.271 250.854 289.286 247.07 289.295C243.179 289.306 239.29 289.341 235.4 289.38C232.393 289.407 229.387 289.415 226.381 289.418C224.948 289.423 223.515 289.435 222.083 289.453C212.468 289.571 204.13 289.248 196.933 282.273C196.11 281.317 195.286 280.36 194.437 279.375C193.59 278.413 192.744 277.452 191.871 276.461C190 274 190 274 190 272C188.385 272.024 188.385 272.024 186.737 272.048C146.071 272.588 146.071 272.588 131 269C130.165 268.812 129.33 268.624 128.469 268.43C109.316 263.999 92.6371 256.363 78.9999 242C77.7894 240.799 77.7894 240.799 76.5546 239.574C58.8775 221.268 53.8991 196.99 53.7967 172.352C53.791 171.259 53.7853 170.166 53.7795 169.041C53.7701 166.736 53.7635 164.432 53.7596 162.127C53.75 158.669 53.7189 155.212 53.6874 151.754C53.5479 122.844 57.1874 96.4296 78.1796 74.8203C103.769 49.2313 136.888 43.5527 171.937 43.6249ZM153.125 120.25C147.567 127.442 147.555 133.859 147.601 142.687C147.599 143.904 147.596 145.12 147.593 146.374C147.591 148.939 147.596 151.504 147.609 154.069C147.625 157.987 147.609 161.903 147.59 165.82C147.592 168.318 147.596 170.815 147.601 173.312C147.595 174.479 147.589 175.646 147.583 176.848C147.643 183.855 147.987 189.324 152.578 194.926C160.528 201.52 168.933 201.878 179 201C184.493 199.811 189.345 198.255 193.125 193.937C195.735 189.848 196.132 187.019 196.177 182.263C196.19 181.084 196.203 179.906 196.216 178.692C196.223 177.417 196.231 176.142 196.238 174.828C196.246 173.517 196.254 172.206 196.263 170.856C196.278 168.078 196.287 165.301 196.295 162.523C196.306 158.978 196.34 155.434 196.38 151.889C196.413 148.493 196.417 145.098 196.426 141.703C196.443 140.436 196.461 139.169 196.479 137.864C196.462 131.03 196.231 126.489 192 121C181.571 112.425 163.848 111.858 153.125 120.25Z" />
                  <path d="M459 -3.05176e-05C475.325 -0.0695115 491.649 -0.123032 507.974 -0.155467C515.554 -0.170928 523.134 -0.192004 530.714 -0.226349C537.322 -0.256274 543.93 -0.275611 550.537 -0.282296C554.035 -0.286203 557.533 -0.29537 561.031 -0.317221C564.938 -0.34143 568.845 -0.341999 572.752 -0.340607C573.909 -0.351393 575.066 -0.362178 576.257 -0.373291C583.532 -0.345212 588.032 0.446284 593.688 5.31247C599.441 11.9992 599.42 17.7708 599.341 26.2475C599.341 27.4774 599.341 28.7072 599.342 29.9743C599.34 33.3335 599.325 36.6922 599.304 40.0514C599.285 43.5668 599.284 47.0821 599.28 50.5975C599.271 57.2485 599.246 63.8994 599.216 70.5503C599.182 78.1246 599.166 85.699 599.151 93.2734C599.12 108.849 599.066 124.424 599 140C592.4 140 585.8 140 579 140C579 100.4 579 60.8 579 20C539.4 20 499.8 20 459 20C459 13.4 459 6.79997 459 -3.05176e-05Z" />
                  <path d="M26.2478 -0.340536C27.4776 -0.340975 28.7074 -0.341413 29.9745 -0.341864C33.3338 -0.340136 36.6925 -0.325127 40.0516 -0.304142C43.567 -0.285345 47.0824 -0.283622 50.5978 -0.280066C57.2488 -0.270754 63.8996 -0.246153 70.5505 -0.216017C78.1249 -0.182446 85.6992 -0.16598 93.2736 -0.150931C108.849 -0.119602 124.425 -0.0662525 140 3.97265e-05C140 6.60004 140 13.2 140 20C100.4 20 60.8002 20 20.0002 20C20.0002 59.6 20.0002 99.2 20.0002 140C13.4002 140 6.80021 140 0.000213623 140C-0.0692673 123.675 -0.122789 107.351 -0.155224 91.0258C-0.170685 83.4457 -0.19176 75.8657 -0.226105 68.2857C-0.25603 61.678 -0.275366 55.0704 -0.282051 48.4627C-0.285958 44.9648 -0.295125 41.467 -0.316977 37.9691C-0.341186 34.0619 -0.341754 30.1549 -0.340363 26.2476C-0.351148 25.091 -0.361934 23.9344 -0.373047 22.7427C-0.344968 15.4681 0.446528 10.9678 5.31271 5.31254C11.9994 -0.441146 17.7711 -0.419584 26.2478 -0.340536Z" />
                </g>
                <defs>
                  <clipPath id="clip0_651_1629">
                    <rect width="599" height="592" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </span>
            <div
              className="relative outline outline-black start-end"
              style={{
                width: `${PHONE_WIDTH}px`,
                height: `${PHONE_HEIGHT}px`,
                borderRadius: `${THUMBNAIL_HEIGHT * 0.075}px`,
                marginLeft: "auto", // This keeps it on the right
                outlineWidth: `${PHONE_WIDTH * 0.05}px`,
                transform: `translateY(${
                  (0.5 - activeState?.qr.pos.y) * PHONE_HEIGHT
                }px)`, // Move phone based on QR Y position
                overflow: "hidden",
              }}
            >
              {/* THIS IS QR CODE SVG! */}
              <div
                style={{
                  position: "absolute",
                  top: `${
                    PHONE_HEIGHT * activeState?.qr.pos.y - QR_GROUP_SIZE / 2
                  }px`,
                  left: `${
                    PHONE_WIDTH * activeState?.qr.pos.x - QR_GROUP_SIZE / 2
                  }px`,
                  width: `${QR_GROUP_SIZE}px`,
                  height: `${QR_GROUP_SIZE}px`,
                  backgroundColor: `${activeState?.qr.borderColor}`,
                  borderRadius: `${
                    QR_GROUP_SIZE * (activeState?.qr.borderRadius / 200)
                  }px`,
                  transform: `rotate(${activeState?.qr.rotation || 0}deg)`,
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                }}
              >
                <svg
                  width={`${QR_SIZE}px`}
                  height={`${QR_SIZE}px`}
                  viewBox="0 0 168 168"
                  fill={activeState?.qr.primaryColor}
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M168 0H0V168H168V0Z"
                    fill={activeState?.qr.secondaryColor}
                  />
                  <path d="M8 0H0V8H8V0Z" />
                  <path d="M8 8H0V16H8V8Z" />
                  <path d="M8 16H0V24H8V16Z" />
                  <path d="M8 24H0V32H8V24Z" />
                  <path d="M8 32H0V40H8V32Z" />
                  <path d="M8 40H0V48H8V40Z" />
                  <path d="M8 48H0V56H8V48Z" />
                  <path d="M8 64H0V72H8V64Z" />
                  <path d="M8 72H0V80H8V72Z" />
                  <path d="M8 112H0V120H8V112Z" />
                  <path d="M8 120H0V128H8V120Z" />
                  <path d="M8 128H0V136H8V128Z" />
                  <path d="M8 136H0V144H8V136Z" />
                  <path d="M8 144H0V152H8V144Z" />
                  <path d="M8 152H0V160H8V152Z" />
                  <path d="M8 160H0V168H8V160Z" />
                  <path d="M16 0H8V8H16V0Z" />
                  <path d="M16 48H8V56H16V48Z" />
                  <path d="M16 64H8V72H16V64Z" />
                  <path d="M16 80H8V88H16V80Z" />
                  <path d="M16 88H8V96H16V88Z" />
                  <path d="M16 96H8V104H16V96Z" />
                  <path d="M16 112H8V120H16V112Z" />
                  <path d="M16 160H8V168H16V160Z" />
                  <path d="M24 0H16V8H24V0Z" />
                  <path d="M24 16H16V24H24V16Z" />
                  <path d="M24 24H16V32H24V24Z" />
                  <path d="M24 32H16V40H24V32Z" />
                  <path d="M24 48H16V56H24V48Z" />
                  <path d="M24 64H16V72H24V64Z" />
                  <path d="M24 72H16V80H24V72Z" />
                  <path d="M24 80H16V88H24V80Z" />
                  <path d="M24 96H16V104H24V96Z" />
                  <path d="M24 112H16V120H24V112Z" />
                  <path d="M24 128H16V136H24V128Z" />
                  <path d="M24 136H16V144H24V136Z" />
                  <path d="M24 144H16V152H24V144Z" />
                  <path d="M24 160H16V168H24V160Z" />
                  <path d="M32 0H24V8H32V0Z" />
                  <path d="M32 16H24V24H32V16Z" />
                  <path d="M32 24H24V32H32V24Z" />
                  <path d="M32 32H24V40H32V32Z" />
                  <path d="M32 48H24V56H32V48Z" />
                  <path d="M32 72H24V80H32V72Z" />
                  <path d="M32 112H24V120H32V112Z" />
                  <path d="M32 128H24V136H32V128Z" />
                  <path d="M32 136H24V144H32V136Z" />
                  <path d="M32 144H24V152H32V144Z" />
                  <path d="M32 160H24V168H32V160Z" />
                  <path d="M40 0H32V8H40V0Z" />
                  <path d="M40 16H32V24H40V16Z" />
                  <path d="M40 24H32V32H40V24Z" />
                  <path d="M40 32H32V40H40V32Z" />
                  <path d="M40 48H32V56H40V48Z" />
                  <path d="M40 64H32V72H40V64Z" />
                  <path d="M40 96H32V104H40V96Z" />
                  <path d="M40 112H32V120H40V112Z" />
                  <path d="M40 128H32V136H40V128Z" />
                  <path d="M40 136H32V144H40V136Z" />
                  <path d="M40 144H32V152H40V144Z" />
                  <path d="M40 160H32V168H40V160Z" />
                  <path d="M48 0H40V8H48V0Z" />
                  <path d="M48 48H40V56H48V48Z" />
                  <path d="M48 64H40V72H48V64Z" />
                  <path d="M48 80H40V88H48V80Z" />
                  <path d="M48 88H40V96H48V88Z" />
                  <path d="M48 112H40V120H48V112Z" />
                  <path d="M48 160H40V168H48V160Z" />
                  <path d="M56 0H48V8H56V0Z" />
                  <path d="M56 8H48V16H56V8Z" />
                  <path d="M56 16H48V24H56V16Z" />
                  <path d="M56 24H48V32H56V24Z" />
                  <path d="M56 32H48V40H56V32Z" />
                  <path d="M56 40H48V48H56V40Z" />
                  <path d="M56 48H48V56H56V48Z" />
                  <path d="M56 64H48V72H56V64Z" />
                  <path d="M56 80H48V88H56V80Z" />
                  <path d="M56 96H48V104H56V96Z" />
                  <path d="M56 112H48V120H56V112Z" />
                  <path d="M56 120H48V128H56V120Z" />
                  <path d="M56 128H48V136H56V128Z" />
                  <path d="M56 136H48V144H56V136Z" />
                  <path d="M56 144H48V152H56V144Z" />
                  <path d="M56 152H48V160H56V152Z" />
                  <path d="M56 160H48V168H56V160Z" />
                  <path d="M64 64H56V72H64V64Z" />
                  <path d="M64 80H56V88H64V80Z" />
                  <path d="M64 96H56V104H64V96Z" />
                  <path d="M72 16H64V24H72V16Z" />
                  <path d="M72 48H64V56H72V48Z" />
                  <path d="M72 56H64V64H72V56Z" />
                  <path d="M72 64H64V72H72V64Z" />
                  <path d="M72 88H64V96H72V88Z" />
                  <path d="M72 96H64V104H72V96Z" />
                  <path d="M72 104H64V112H72V104Z" />
                  <path d="M72 112H64V120H72V112Z" />
                  <path d="M72 120H64V128H72V120Z" />
                  <path d="M72 128H64V136H72V128Z" />
                  <path d="M72 144H64V152H72V144Z" />
                  <path d="M72 152H64V160H72V152Z" />
                  <path d="M72 160H64V168H72V160Z" />
                  <path d="M80 32H72V40H80V32Z" />
                  <path d="M80 40H72V48H80V40Z" />
                  <path d="M80 72H72V80H80V72Z" />
                  <path d="M80 80H72V88H80V80Z" />
                  <path d="M80 104H72V112H80V104Z" />
                  <path d="M80 112H72V120H80V112Z" />
                  <path d="M80 120H72V128H80V120Z" />
                  <path d="M80 128H72V136H80V128Z" />
                  <path d="M80 136H72V144H80V136Z" />
                  <path d="M88 0H80V8H88V0Z" />
                  <path d="M88 16H80V24H88V16Z" />
                  <path d="M88 40H80V48H88V40Z" />
                  <path d="M88 48H80V56H88V48Z" />
                  <path d="M88 56H80V64H88V56Z" />
                  <path d="M88 64H80V72H88V64Z" />
                  <path d="M88 88H80V96H88V88Z" />
                  <path d="M88 104H80V112H88V104Z" />
                  <path d="M88 120H80V128H88V120Z" />
                  <path d="M96 32H88V40H96V32Z" />
                  <path d="M96 40H88V48H96V40Z" />
                  <path d="M96 72H88V80H96V72Z" />
                  <path d="M96 80H88V88H96V80Z" />
                  <path d="M96 88H88V96H96V88Z" />
                  <path d="M96 96H88V104H96V96Z" />
                  <path d="M96 104H88V112H96V104Z" />
                  <path d="M96 120H88V128H96V120Z" />
                  <path d="M96 144H88V152H96V144Z" />
                  <path d="M104 0H96V8H104V0Z" />
                  <path d="M104 8H96V16H104V8Z" />
                  <path d="M104 24H96V32H104V24Z" />
                  <path d="M104 32H96V40H104V32Z" />
                  <path d="M104 48H96V56H104V48Z" />
                  <path d="M104 64H96V72H104V64Z" />
                  <path d="M104 88H96V96H104V88Z" />
                  <path d="M104 112H96V120H104V112Z" />
                  <path d="M104 120H96V128H104V120Z" />
                  <path d="M104 136H96V144H104V136Z" />
                  <path d="M104 144H96V152H104V144Z" />
                  <path d="M112 64H104V72H112V64Z" />
                  <path d="M112 72H104V80H112V72Z" />
                  <path d="M112 80H104V88H112V80Z" />
                  <path d="M112 88H104V96H112V88Z" />
                  <path d="M112 128H104V136H112V128Z" />
                  <path d="M112 136H104V144H112V136Z" />
                  <path d="M112 160H104V168H112V160Z" />
                  <path d="M120 0H112V8H120V0Z" />
                  <path d="M120 8H112V16H120V8Z" />
                  <path d="M120 16H112V24H120V16Z" />
                  <path d="M120 24H112V32H120V24Z" />
                  <path d="M120 32H112V40H120V32Z" />
                  <path d="M120 40H112V48H120V40Z" />
                  <path d="M120 48H112V56H120V48Z" />
                  <path d="M120 64H112V72H120V64Z" />
                  <path d="M120 72H112V80H120V72Z" />
                  <path d="M120 80H112V88H120V80Z" />
                  <path d="M120 104H112V112H120V104Z" />
                  <path d="M120 136H112V144H120V136Z" />
                  <path d="M120 144H112V152H120V144Z" />
                  <path d="M128 0H120V8H128V0Z" />
                  <path d="M128 48H120V56H128V48Z" />
                  <path d="M128 72H120V80H128V72Z" />
                  <path d="M128 80H120V88H128V80Z" />
                  <path d="M128 104H120V112H128V104Z" />
                  <path d="M128 112H120V120H128V112Z" />
                  <path d="M128 120H120V128H128V120Z" />
                  <path d="M128 144H120V152H128V144Z" />
                  <path d="M136 0H128V8H136V0Z" />
                  <path d="M136 16H128V24H136V16Z" />
                  <path d="M136 24H128V32H136V24Z" />
                  <path d="M136 32H128V40H136V32Z" />
                  <path d="M136 48H128V56H136V48Z" />
                  <path d="M136 72H128V80H136V72Z" />
                  <path d="M136 80H128V88H136V80Z" />
                  <path d="M136 88H128V96H136V88Z" />
                  <path d="M136 104H128V112H136V104Z" />
                  <path d="M136 112H128V120H136V112Z" />
                  <path d="M136 120H128V128H136V120Z" />
                  <path d="M136 128H128V136H136V128Z" />
                  <path d="M136 136H128V144H136V136Z" />
                  <path d="M136 144H128V152H136V144Z" />
                  <path d="M136 160H128V168H136V160Z" />
                  <path d="M144 0H136V8H144V0Z" />
                  <path d="M144 16H136V24H144V16Z" />
                  <path d="M144 24H136V32H144V24Z" />
                  <path d="M144 32H136V40H144V32Z" />
                  <path d="M144 48H136V56H144V48Z" />
                  <path d="M144 80H136V88H144V80Z" />
                  <path d="M144 96H136V104H144V96Z" />
                  <path d="M144 112H136V120H144V112Z" />
                  <path d="M144 120H136V128H144V120Z" />
                  <path d="M144 160H136V168H144V160Z" />
                  <path d="M152 0H144V8H152V0Z" />
                  <path d="M152 16H144V24H152V16Z" />
                  <path d="M152 24H144V32H152V24Z" />
                  <path d="M152 32H144V40H152V32Z" />
                  <path d="M152 48H144V56H152V48Z" />
                  <path d="M152 64H144V72H152V64Z" />
                  <path d="M152 136H144V144H152V136Z" />
                  <path d="M160 0H152V8H160V0Z" />
                  <path d="M160 48H152V56H160V48Z" />
                  <path d="M160 80H152V88H160V80Z" />
                  <path d="M160 96H152V104H160V96Z" />
                  <path d="M160 112H152V120H160V112Z" />
                  <path d="M160 120H152V128H160V120Z" />
                  <path d="M160 128H152V136H160V128Z" />
                  <path d="M160 136H152V144H160V136Z" />
                  <path d="M160 152H152V160H160V152Z" />
                  <path d="M160 160H152V168H160V160Z" />
                  <path d="M168 0H160V8H168V0Z" />
                  <path d="M168 8H160V16H168V8Z" />
                  <path d="M168 16H160V24H168V16Z" />
                  <path d="M168 24H160V32H168V24Z" />
                  <path d="M168 32H160V40H168V32Z" />
                  <path d="M168 40H160V48H168V40Z" />
                  <path d="M168 48H160V56H168V48Z" />
                  <path d="M168 72H160V80H168V72Z" />
                  <path d="M168 80H160V88H168V80Z" />
                  <path d="M168 88H160V96H168V88Z" />
                  <path d="M168 96H160V104H168V96Z" />
                  <path d="M168 104H160V112H168V104Z" />
                  <path d="M168 112H160V120H168V112Z" />
                  <path d="M168 144H160V152H168V144Z" />
                  <path d="M168 160H160V168H168V160Z" />
                </svg>
              </div>
            </div>
          </div>
  );
};

export default ThumbnailDiv;
